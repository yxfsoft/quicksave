# QuickSave 需求调整说明 (V2)

## 一、微信内容收藏方案调整

### 1.1 公众号文章

| 原方案 | 新方案 |
|--------|--------|
| 截图 + OCR 识别 | **快捷键 + UI Automation + 浏览器扩展抓取** |

**实现流程**：
```
用户在微信打开文章 → 按快捷键 →
客户端检测微信文章窗口 →
通过 UI Automation API 获取文章 URL →
调用浏览器扩展在后台打开 URL →
扩展抓取文章全文（标题、作者、正文、图片）→
保存到云端
```

**技术要点**：
- 使用 Windows UI Automation API 读取微信内嵌浏览器的 URL
- 不读取微信数据库，避免安全风险
- 抓取工作由浏览器扩展完成

---

### 1.2 视频号

| 原方案 | 新方案 |
|--------|--------|
| 截图 + 链接提取 | **快捷键 + UI Automation + API 解析** |

**实现流程**：
```
用户在微信打开视频号 → 按快捷键 →
客户端检测视频号窗口 →
通过 UI Automation 获取视频号 ID →
调用解析服务获取视频信息（标题、作者、封面、时长、下载链接）→
保存到云端
```

**解析内容**：
- 标题
- 作者
- 封面图
- 时长
- 视频下载链接（无水印）

---

### 1.3 聊天记录

| 原方案 | 新方案 |
|--------|--------|
| 读取微信本地数据库 | **剪贴板监听（复制粘贴收藏）** |

**实现流程**：
```
用户在微信选中聊天内容 → Ctrl+C 复制 →
客户端监听剪贴板 →
检测到微信内容格式 →
解析并收藏
```

**原因**：
- 读取微信数据库需要解密 Key
- 获取 Key 需要读进程内存，会触发杀软警告
- PC 端数据库不含手机端历史，数据不完整

---

### 1.4 朋友圈

| 原方案 | 新方案 |
|--------|--------|
| 截图 + OCR 识别 | **不做** |

---

## 二、视频平台方案调整

### 2.1 B站

| 项目 | 方案 |
|------|------|
| 收藏方式 | 浏览器扩展收藏 |
| 解析位置 | 浏览器扩展内 |
| 解析内容 | 全部（标题、封面、UP主、播放量、时长、简介、分P、下载链接） |

### 2.2 YouTube

| 项目 | 方案 |
|------|------|
| 收藏方式 | 浏览器扩展收藏 |
| 解析位置 | 浏览器扩展内 |
| 解析内容 | 全部（标题、封面、频道、时长、描述、下载链接） |

### 2.3 抖音

| 项目 | 方案 |
|------|------|
| 第一版 | **不做** |
| 后续 | 通过剪贴板监听分享链接 |

### 2.4 视频下载

| 项目 | 方案 |
|------|------|
| 自动下载 | **不做** |
| 保存内容 | 只保存信息 + 下载链接 |
| 用户操作 | 点击链接自行下载 |

---

## 三、其他功能调整

### 3.1 用户登录

| 原方案 | 新方案 |
|--------|--------|
| 手机号 + 微信 | **微信 + 手机号**（都做） |

### 3.2 全文搜索

| 原方案 | 新方案 |
|--------|--------|
| 阿里云 Elasticsearch | **Tablestore 内置搜索** |

**原因**：
- 初期成本低（几乎免费）
- 对于小数据量足够使用
- 后续可升级到 OpenSearch

### 3.3 导入功能

| 原方案 | 新方案 |
|--------|--------|
| 多平台导入 | **只做浏览器书签导入** |

支持的格式：
- Chrome HTML 导出
- Edge HTML 导出
- Firefox HTML/JSON 导出

### 3.4 导出功能

| 原方案 | 新方案 |
|--------|--------|
| JSON/Markdown/HTML | **第一版不做** |

### 3.5 统计分析

| 原方案 | 新方案 |
|--------|--------|
| 收藏趋势、标签分布等 | **第一版不做** |

### 3.6 分享链接

| 原方案 | 新方案 |
|--------|--------|
| P1 优先级 | **需要做**（提升到 P0） |

---

## 四、技术方案调整

### 4.1 内容抓取位置

| 内容类型 | 抓取位置 |
|----------|----------|
| 网页内容 | 浏览器扩展 |
| 公众号文章 | 浏览器扩展 |
| B站/YouTube | 浏览器扩展 |
| 视频号解析 | 客户端调用解析服务 |
| 聊天记录 | 客户端剪贴板监听 |

### 4.2 快捷键

| 原方案 | 新方案 |
|--------|--------|
| 固定快捷键 Ctrl+Shift+S | **用户自定义** |

首次启动时引导用户设置快捷键。

### 4.3 客户端分发

| 项目 | 方案 |
|------|------|
| 下载渠道 | 官网下载 |
| 自动更新 | 支持 |
| 应用商店 | 暂不上架 |

---

## 五、第一版功能范围

### 5.1 包含的功能

| 模块 | 功能 |
|------|------|
| 用户系统 | 微信登录、手机号登录 |
| 触发方式 | 全局快捷键（用户自定义）、浏览器扩展按钮 |
| 内容收藏 | 网页、公众号、视频号、B站、YouTube、GitHub、Stack Overflow |
| 微信收藏 | 公众号（URL抓取）、视频号（API解析）、聊天（剪贴板） |
| 智能处理 | 自动标签、智能分类、内容摘要 |
| AI 服务 | 通义千问（可配置切换） |
| 内容管理 | 列表/卡片视图切换、标签管理、搜索筛选 |
| 搜索 | Tablestore 内置搜索 |
| 分享 | 生成分享链接 |
| 导入 | 浏览器书签导入 |
| 平台 | Windows 客户端 + Chrome/Edge 扩展 + Web 管理 |

### 5.2 不包含的功能（后续迭代）

| 功能 | 原因 |
|------|------|
| 朋友圈收藏 | 需求不迫切 |
| 抖音收藏 | 技术难度高 |
| 微信历史导入 | PC 数据不完整 |
| 导出功能 | 优先级低 |
| 统计分析 | 优先级低 |
| 视频自动下载 | 只保存链接 |
| B站/YouTube 收藏导入 | 后续迭代 |

---

## 六、系统架构调整

### 6.1 更新后的架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户层                                   │
├──────────────────┬──────────────────┬──────────────────────────┤
│  Flutter Desktop │  Browser Extension│      Web Dashboard       │
│   (Windows客户端)  │  (Chrome/Edge)    │     (Flutter Web)        │
│   - 全局快捷键    │  - 网页/视频抓取  │     - 内容管理           │
│   - UI Automation│  - 公众号抓取     │     - 搜索查看           │
│   - 剪贴板监听   │  - B站/YT解析     │                          │
├──────────────────┴──────────────────┴──────────────────────────┤
│                         API Gateway                             │
├─────────────────────────────────────────────────────────────────┤
│                    阿里云 FC (FastAPI)                          │
├────────────┬────────────┬────────────┬─────────────────────────┤
│  用户服务   │  收藏服务   │  AI服务    │     视频号解析服务       │
├────────────┴────────────┴────────────┴─────────────────────────┤
│                         数据层                                   │
├──────────────────┬──────────────────────────────────────────────┤
│  阿里云 Tablestore │          阿里云 OSS                         │
│  (数据库 + 搜索)   │         (文件存储)                          │
└──────────────────┴──────────────────────────────────────────────┘
```

### 6.2 组件职责

| 组件 | 职责 |
|------|------|
| Flutter Desktop | 全局快捷键、窗口检测、剪贴板监听、托盘程序 |
| Browser Extension | 网页抓取、公众号抓取、视频解析、与客户端通信 |
| FastAPI 后端 | 用户认证、数据存储、AI 调用、视频号解析 |
| Flutter Web | 内容管理界面、搜索、设置 |

---

## 七、开发注意事项

### 7.1 微信窗口检测

```dart
// 使用 win32 API 检测微信窗口
// 窗口类名示例
const wechatWindowClass = 'WeChatMainWndForPC';
const articleWindowClass = 'CefWebViewWnd';  // 公众号文章窗口
const finderWindowClass = 'FinderWindow';    // 视频号窗口
```

### 7.2 UI Automation 获取 URL

```dart
// 使用 Windows UI Automation
// 从微信内嵌浏览器获取当前 URL
// 需要遍历 Automation Tree 找到地址栏元素
```

### 7.3 扩展与客户端通信

```javascript
// 浏览器扩展通过 Native Messaging 与客户端通信
// 或通过本地 HTTP 服务通信
chrome.runtime.connectNative('com.quicksave.host');
```

---

*更新日期: 2026-01-22*
